
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AdminLTE 3 | Dashboard 3</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- IonIcons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
</head>
<!--
`body` tag options:

  Apply one or more of the following classes to to the body tag
  to get the desired effect

  * sidebar-collapse
  * sidebar-mini
-->
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">My CV</a>
      </li>
    </ul>

  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="index3.html" class="brand-link">
      <img src="dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
      <span class="brand-text font-weight-light">AdminLTE 3</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      
      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item">
            <a href="pages/widgets.html" class="nav-link">
              <i class="nav-icon fas fa-th"></i>
              <p>
                Mortgage calculator
              </p>
            </a>
          </li>          
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0 text-dark">Mortgage calculator</h1>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <div class="content">    
      <div class="container-fluid">

      	<div class="row">
          
          <div class="col-md-3">
            <div class="card card-widget">
              <div class="card-header">
                <div class="card-title">
                  1. Check basic settings
                </div>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <div class="card-body">
              	This is basic place for configuring main mortgage paramenters. Some default values are proposed.
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card card-widget">
              <div class="card-header">
                <div class="card-title">
                  2. Click "Calculate" for result
                </div>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <div class="card-body">
              	The results of calculation will be written in this field.
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card card-widget">
              <div class="card-header">
                <div class="card-title">
                  3. Configure spendings/income
                </div>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <div class="card-body">
              	This block is trickier. Every month you get some amount of "Monthly Income". That is money that you put on your deposit every month.
              	Money on the deposit may grow by deposit percent. While the person have no priivate apartment he/she may need to pay monthly rent price.
              	The question which is answered by this block is the following: Should I take mortgage now, when I have 10% of the required budget, 20%, 30%, ..., or should I just collect the full price of new apartment.
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card card-widget">
              <div class="card-header">
                <div class="card-title">
                  4. Configure apartment price growth
                </div>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <div class="card-body">
              	The block №3 does not aware of apartment price growh. On the long run the price of the apartments may vary a lot. This box allows applying apartment price growth. That may пкуфедн change results of block №3.
              </div>
            </div>
          </div>

        </div>
        <!-- /.row -->

      	<div class="row">
          <!-- Mortgage settings-->
          <div class="col-lg-3">
            <div class="card card-primary">

              <div class="card-header border-0">
                <div class="d-flex justify-content-between">
                  <h3 class="card-title">Mortgage settings</h3>
                </div>
              </div>

              <div class="card-body">

                <label>Price</label>
                <div class="input-group mb-3">
                  <input id="price" type="number" class="form-control" value="3000000">
                </div>

                <label>Budget</label>
                <div class="input-group mb-3">
                  <input id="budget" type="number" class="form-control" value="0">
                </div>

                <label>Percent</label>
                <div class="input-group mb-3">
                  <input id="percent" type="number" class="form-control" value="9">
                </div>

                <label>Duration (months)</label>
                <div class="input-group mb-3">
                  <input id="duration" type="number" class="form-control" value="120">
                </div>

              </div>
            </div>
            <!-- /.card -->
          </div>

          <!-- Calculated values-->
          <div class="col-lg-3">
            <div class="card card-primary">

              <div class="card-header border-0">
                <div class="d-flex justify-content-between">
                  <h3 class="card-title">Calculated basic values</h3>
                </div>
              </div>

              <div class="card-body">

                <label>Montly payment</label>
                <div class="input-group mb-3">
                  <input id="monthly" type="number" class="form-control">
                </div>

                <label>Overpay <span id="overpay-percent"></span></label>
                <div class="input-group mb-3">
                  <input id="overpay" type="number" class="form-control">
                </div>

              </div>
              <div class="card-footer">
                  <button onclick="calculate()" class="btn btn-primary">Calculate</button>
              </div>
            </div>
            <!-- /.card -->            
          </div>

          <!-- Calculated values-->
          <div class="col-lg-3">
            <div class="card card-primary">

              <div class="card-header border-0">
                <div class="d-flex justify-content-between">
                  <h3 class="card-title">Best time to buy</h3>
                </div>
              </div>

              <div class="card-body">

                <label>Monthly Income</label>
                <div class="input-group mb-3">
                  <input id="income" type="number" class="form-control" value="50000">
                </div>

                <label>Deposit Percent <span id="overpay-percent"></span></label>
                <div class="input-group mb-3">
                  <input id="deposit" type="number" class="form-control" value="5">
                </div>

                <label>Rent price <span id="overpay-percent"></span></label>
                <div class="input-group mb-3">
                  <input id="rent_price" type="number" class="form-control" value="25000">
                </div>

              </div>
              <div class="card-footer">
                  <button onclick="calculate_best_time()" class="btn btn-primary">Calculate best time</button>
              </div>
            </div>
            <!-- /.card -->
          </div>

          <!-- Calculated values-->
          <div class="col-lg-3">
            <div class="card card-primary">

              <div class="card-header border-0">
                <div class="d-flex justify-content-between">
                  <h3 class="card-title">Best time with price growth</h3>
                </div>
              </div>

              <div class="card-body">

                <label>Price growth percent</label>
                <div class="input-group mb-3">
                  <input id="price_growth" type="number" class="form-control" value="5">
                </div>


              </div>
              <div class="card-footer">
                  <button onclick="calculate_best_time_with_growth()" class="btn btn-primary">Calculate best time with percent</button>
              </div>
            </div>
            <!-- /.card -->
          </div>

        </div>
        <!-- /.row -->
        <div class="row">
          <!-- Mortgage settings-->
          <div class="col-lg-12">
            <div class="card card-primary">

              <div class="card-header border-0">
                <div class="d-flex justify-content-between">
                  <h3 class="card-title">Wealth plot</h3>
                </div>
              </div>

              <div class="card-body">

                <div id="container" style="height: 600px; min-width: 100%"></div>

              </div>
            </div>
            <!-- /.card -->
          </div>
        </div>
      </div>
      <!-- /.container-fluid -->
    </div>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <strong>Copyright &copy; 2014-2020 <a href="https://adminlte.io">AdminLTE.io</a>.</strong>
    All rights reserved.
    <div class="float-right d-none d-sm-inline-block">
      <b>Version</b> 3.1.0-pre
    </div>
  </footer>
</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE -->
<script src="dist/js/adminlte.js"></script>

<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
<script src="https://code.highcharts.com/stock/modules/export-data.js"></script>

<script>
function calculate() {
  var price = document.getElementById("price").value;
  var budget = document.getElementById("budget").value;
  var percent = document.getElementById("percent").value / 12 / 100;
  var duration = document.getElementById("duration").value;

  var coefficient = (percent * Math.pow(1 + percent, duration)) / (Math.pow(1 + percent, duration) - 1);
  var monthly = coefficient * (price - budget);

  var overpay = duration * monthly - (price - budget);
  var overpay_percent = (overpay / (price - budget)) * 100;

  document.getElementById("monthly").value = monthly.toFixed(2);
  document.getElementById("overpay").value = overpay.toFixed(2);
  document.getElementById("overpay-percent").innerHTML = overpay_percent.toFixed(2) + "%";
}

function calculate_best_time() {
  var monthly_income = parseFloat(document.getElementById("income").value);
  var deposit_percent = parseFloat(document.getElementById("deposit").value / 100);
  var mortgage_percent = parseFloat(document.getElementById("percent").value / 100);
  var price = parseFloat(document.getElementById("price").value);
  var rent_price = parseFloat(document.getElementById("rent_price").value);
  var model_duration = 12 * 20;
  var default_mortgage_period = parseFloat(document.getElementById("duration").value);

  var debt = 0;
  var budget = 0;

  seriesOptions = [
  ]
  //-------------------------------------------------
  for (var start = 0.00; start <= 1; start=start + 0.1) {
    budget = 0;
    debt = 0;
    var have_appartment = false;
    var strategy_points = [];
    for (var i = 0; i < model_duration; i++) {
      var monthly_mortgage_percent = mortgage_percent / 12;
      var coefficient = (monthly_mortgage_percent * Math.pow(1 + monthly_mortgage_percent, default_mortgage_period)) / (Math.pow(1 + monthly_mortgage_percent, default_mortgage_period) - 1);
      var monthly_payment = coefficient * (price - budget);

      if ((have_appartment == false) && (budget > price * start) && (monthly_payment < monthly_income)) {
        debt = price - budget;
        budget = 0;
        have_appartment = true;
      }

      var current_month_income = monthly_income;
      if (have_appartment == false){
        current_month_income = current_month_income - rent_price;
      }

      if (debt > 0) {
        var as_percent = debt * mortgage_percent / 12;
        var as_debt = monthly_income - as_percent;
        debt = debt - as_debt;
        if (debt < 0) {
          current_month_income = -debt;
        }
      }

      budget = budget + (budget * deposit_percent / 12);
      if (debt <= 0){
        budget = budget + current_month_income;
        console.log(typeof(budget));

      }

      strategy_points.push([i * 1000 * 60 * 60 * 24 * 30.42, budget]);
    }
    seriesOptions.push(
      {
        name: (start * 100).toFixed(2) + '%',
        data: strategy_points
      }
    );
  }
  //--------------------------------------------------

  console.log(seriesOptions);
  createChart();
}

function calculate_best_time_with_growth() {
  var monthly_income = parseFloat(document.getElementById("income").value);
  var deposit_percent = parseFloat(document.getElementById("deposit").value) / 100;
  var mortgage_percent = parseFloat(document.getElementById("percent").value) / 100;
  var price = parseFloat(document.getElementById("price").value);
  var rent_price = parseFloat(document.getElementById("rent_price").value);
  var model_duration = 12 * 20;
  var default_mortgage_period = parseFloat(document.getElementById("duration").value);
  var price_growth = parseFloat(document.getElementById("price_growth").value)  / 100;

  var debt = 0;
  var budget = 0;

  seriesOptions = [
  ]
  //-------------------------------------------------
  for (var start = 0.00; start <= 1; start=start + 0.1) {
    budget = 0;
    debt = 0;
    price = parseFloat(document.getElementById("price").value);
    var have_appartment = false;
    var strategy_points = [];
    for (var i = 0; i < model_duration; i++) {
      var monthly_mortgage_percent = mortgage_percent / 12;
      var coefficient = (monthly_mortgage_percent * Math.pow(1 + monthly_mortgage_percent, default_mortgage_period)) / (Math.pow(1 + monthly_mortgage_percent, default_mortgage_period) - 1);
      var monthly_payment = coefficient * (price - budget);

      if ((i + 1) % 12 == 0) {
        console.log('Old price' + price);
        price += price * price_growth;
        console.log('New price' + price);
      }

      if ((have_appartment == false) && (budget > price * start) && (monthly_payment < monthly_income)) {
        debt = price - budget;
        budget = 0;
        have_appartment = true;
      }

      var current_month_income = monthly_income;
      if (have_appartment == false){
        current_month_income = current_month_income - rent_price;
      }

      if (debt > 0) {
        var as_percent = debt * mortgage_percent / 12;
        var as_debt = monthly_income - as_percent;
        debt = debt - as_debt;
        if (debt < 0) {
          current_month_income = -debt;
        }
      }

      budget = budget + (budget * deposit_percent / 12);
      if (debt <= 0){
        budget = budget + current_month_income;
        console.log(typeof(budget));

      }

      strategy_points.push([i * 1000 * 60 * 60 * 24 * 30.42, budget]);
    }
    seriesOptions.push(
      {
        name: (start * 100).toFixed(2) + '%',
        data: strategy_points
      }
    );
  }
  //--------------------------------------------------

  console.log(seriesOptions);
  createChart();
}


/**
 * Create the chart when all data is loaded
 * @returns {undefined}
 */
function createChart() {

    Highcharts.stockChart('container', {

        rangeSelector: {
            selected: 4
        },

        yAxis: {
            plotLines: [{
                value: 0,
                width: 2,
                color: 'silver'
            }]
        },

        plotOptions: {
            series: {
            }
        },

        tooltip: {
            pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change})<br/>',
            valueDecimals: 2,
            split: true
        },

        series: seriesOptions
    });
}

</script>

</body>
</html>

